#!/bin/bash

# Very simple import script that leverages bunzip2 unix-command and duckdb CLI to import, streaming

for file in $(find data/epf -name '*.tbz'); do
  table=$(basename "${file}" .tbz)
  echo "Importing ${table}"
  node ./lib/sql.js $table | duckdb data/epf.duckdb
  bunzip2 -c "${file}" | node ./lib/epf2csv.js | duckdb data/epf.duckdb -c "INSERT OR REPLACE INTO ${table} SELECT * FROM read_csv('/dev/stdin', header=true, nullstr='');"
done
